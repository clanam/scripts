#
# This pre-commit hook lint-fixes all altered js files and optionally adds them
# to git. To configure/disable parts of it, set one of the following env
# variables, e.g. in your ~/.bash_profile file.
#

root_dir=`git rev-parse --show-toplevel`
altered_js_files=`git diff HEAD --cached --name-only --diff-filter=ACM | grep .js$ | grep -v .eslintrc.js$`

if ! [ -z "$altered_js_files" ]
then
  printf "   üßπ linting js files with --fix...\n"
  # Manually clean up js files. If it fails, use || to ignore the error (we don't
  # want to block the commit). Let lint print its warnings
  $root_dir/node_modules/.bin/eslint --fix $altered_js_files || printf ""

  printf "   üçµ Adding linted files to git \n"
  for file in $altered_js_files
  do
    git add $file
  done
fi